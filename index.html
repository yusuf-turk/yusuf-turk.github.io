<script>
    // --- 1. HARİTA ALTLIKLARI (SEÇENEKLER) ---
    
    // A. Standart Harita (Şu anki)
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap'
    });

    // B. Uydu Görüntüsü (Esri) - Tarihi kalıntılar için harika
    var uydu = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles © Esri'
    });

    // C. Fiziki Harita (Dağlar/Tepeler) - Coğrafyayı gösterir
    var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenTopoMap'
    });

    // D. Sade Harita (Gri/Beyaz) - Veriyi öne çıkarır
    var sade = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '© CARTO'
    });


    // --- 2. HARİTAYI BAŞLATMA ---
    // Varsayılan olarak 'sade' harita ile açılsın istedim (Değiştirebilirsin: osm, uydu, topo)
    var map = L.map('map', {
        center: [37.7765, 29.0864],
        zoom: 9,
        zoomControl: false,
        minZoom: 8,
        layers: [sade] // Açılışta bu katman gelsin
    });
    
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    // KATMAN KONTROL MENÜSÜNÜ EKLE (Sağ Üst)
    var baseMaps = {
        "Sade Harita": sade,
        "Uydu Görüntüsü": uydu,
        "Fiziki (Dağlık)": topo,
        "Standart": osm
    };
    L.control.layers(baseMaps).addTo(map);


    // --- 3. DENİZLİ MASKELEME (KARARTMA) ---
    fetch('https://raw.githubusercontent.com/cihadturhan/tr-geojson/master/geo/tr-cities-utf8.json')
        .then(res => res.json())
        .then(data => {
            var denizliFeature = data.features.find(f => f.properties.name === 'Denizli');
            if (denizliFeature) {
                // Sınır Çizgisi
                L.geoJSON(denizliFeature, {
                    style: { color: '#e74c3c', weight: 3, fillOpacity: 0 }
                }).addTo(map);

                // Maskeleme (Dışarıyı Karartma)
                var worldPolygon = [[90, -180], [90, 180], [-90, 180], [-90, -180]]; 
                var denizliCoords = [];
                var geometry = denizliFeature.geometry;
                
                if (geometry.type === 'Polygon') {
                    denizliCoords = geometry.coordinates[0].map(c => [c[1], c[0]]);
                } else if (geometry.type === 'MultiPolygon') {
                    denizliCoords = geometry.coordinates[0][0].map(c => [c[1], c[0]]);
                }

                L.polygon([worldPolygon, denizliCoords], {
                    color: 'transparent', 
                    fillColor: '#000',    
                    fillOpacity: 0.85     
                }).addTo(map);

                map.fitBounds(L.geoJSON(denizliFeature).getBounds());
            }
        });


    // --- 4. İÇERİK VERİTABANI ---
    var locationData = {
        "tavas": {
            title: "Kale-i Tavas Mezarlığı",
            img: "https://via.placeholder.com/400x250?text=Kale-i+Tavas", 
            desc: "Kale-i Tavas, Denizli'nin güneybatısında yer alan tarihi bir yerleşimdir. Kayı ve Avşar boyu tamgaları burada yoğunlaşmıştır."
        },
        "cardak": {
            title: "Çardak Han Kervansarayı",
            img: "https://via.placeholder.com/400x250?text=Cardak+Han",
            desc: "İpek Yolu üzerindeki bu han, Selçuklu taş işçiliğinde kullanılan usta tamgalarını barındırır."
        },
        "muze": {
            title: "Denizli Kent Müzesi",
            img: "https://via.placeholder.com/400x250?text=Kent+Muzesi",
            desc: "Bölge Yörük kültürüne ait eserlerdeki dokuma ve metal tamgaları burada sergilenmektedir."
        },
        "civril": {
            title: "Çivril Özdemirci Mezarlığı",
            img: "https://via.placeholder.com/400x250?text=Civril+Mezarligi",
            desc: "İslamiyet öncesi Türk inancının izlerini taşıyan balbal taşları ve damgalar bu bölgede bulunur."
        }
    };

    // --- 5. MARKER VE HEATMAP ---
    var locations = [
        { id: "tavas", coords: [37.568, 29.070] },
        { id: "cardak", coords: [37.825, 29.660] },
        { id: "muze", coords: [37.774, 29.087] },
        { id: "civril", coords: [38.295, 29.730] }
    ];

    var heatPoints = [];
    locations.forEach(loc => {
        heatPoints.push([loc.coords[0], loc.coords[1], 1.0]);
        for(let i=0; i<40; i++) {
            heatPoints.push([
                loc.coords[0] + (Math.random()-0.5)/15, 
                loc.coords[1] + (Math.random()-0.5)/15, 
                0.6
            ]);
        }
    });
    L.heatLayer(heatPoints, { radius: 25, blur: 20, gradient: {0.4: 'blue', 1: 'red'} }).addTo(map);

    locations.forEach(function(loc) {
        var marker = L.marker(loc.coords).addTo(map);
        marker.on('click', function() {
            var data = locationData[loc.id];
            var sidebar = document.getElementById('sidebar-content');
            sidebar.innerHTML = `
                <h2 class="info-title">${data.title}</h2>
                <img src="${data.img}" class="info-img" alt="${data.title}">
                <p class="info-text">${data.desc}</p>
                <br><small style="color:#888">Koordinat: ${loc.coords}</small>
            `;
        });
    });

    </script>
